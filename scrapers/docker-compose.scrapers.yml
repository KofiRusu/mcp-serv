# =============================================================================
# ChatOS Trading Scrapers - Docker Compose
# 24/7 data collection for market data, news, and sentiment
# =============================================================================
#
# Usage:
#   docker-compose -f docker-compose.scrapers.yml up -d     # Start all scrapers
#   docker-compose -f docker-compose.scrapers.yml down      # Stop all scrapers
#   docker-compose -f docker-compose.scrapers.yml logs -f   # View logs
#
# =============================================================================

version: '3.8'

services:
  # ===========================================================================
  # Market Data Scraper
  # Collects: tickers, order books, trades, OHLCV candles
  # ===========================================================================
  market-scraper:
    build:
      context: ..
      dockerfile: scrapers/Dockerfile.scraper
    container_name: chatos-market-scraper
    restart: always
    volumes:
      - ../sandbox-ui/data/market-history:/app/data/market-history
      - scraper-logs:/app/logs
    environment:
      - SCRAPER_TYPE=market
      - SYMBOLS=BTCUSDT,ETHUSDT,SOLUSDT,BNBUSDT,XRPUSDT,ADAUSDT
      - INTERVAL_SECONDS=30
      - PYTHONUNBUFFERED=1
    command: python -u market_scraper.py
    healthcheck:
      test: ["CMD", "python", "-c", "import os; exit(0 if os.path.exists('/app/data/market-history') else 1)"]
      interval: 60s
      timeout: 10s
      retries: 3

  # ===========================================================================
  # News Scraper
  # Collects: crypto news from various sources
  # ===========================================================================
  news-scraper:
    build:
      context: ..
      dockerfile: scrapers/Dockerfile.scraper
    container_name: chatos-news-scraper
    restart: always
    volumes:
      - ../sandbox-ui/data/news:/app/data/news
      - scraper-logs:/app/logs
    environment:
      - SCRAPER_TYPE=news
      - INTERVAL_SECONDS=300
      - PYTHONUNBUFFERED=1
    command: python -u news_scraper.py
    healthcheck:
      test: ["CMD", "python", "-c", "import os; exit(0 if os.path.exists('/app/data/news') else 1)"]
      interval: 300s
      timeout: 10s
      retries: 3

  # ===========================================================================
  # Sentiment Scraper
  # Collects: Fear & Greed index, market sentiment, funding rates
  # ===========================================================================
  sentiment-scraper:
    build:
      context: ..
      dockerfile: scrapers/Dockerfile.scraper
    container_name: chatos-sentiment-scraper
    restart: always
    volumes:
      - ../sandbox-ui/data/sentiment:/app/data/sentiment
      - scraper-logs:/app/logs
    environment:
      - SCRAPER_TYPE=sentiment
      - INTERVAL_SECONDS=600
      - PYTHONUNBUFFERED=1
    command: python -u sentiment_scraper.py
    healthcheck:
      test: ["CMD", "python", "-c", "import os; exit(0 if os.path.exists('/app/data/sentiment') else 1)"]
      interval: 300s
      timeout: 10s
      retries: 3

volumes:
  scraper-logs:
    name: chatos-scraper-logs

networks:
  default:
    name: chatos-scrapers-network

