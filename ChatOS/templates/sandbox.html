<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatOS - Coding Sandbox</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app sandbox-app">
        <!-- File Explorer Sidebar -->
        <aside class="sidebar file-explorer">
            <div class="sidebar-header">
                <a href="/" class="logo">
                    <span class="logo-icon">‚ö°</span>
                    <span class="logo-text">ChatOS</span>
                </a>
                <span class="version">Sandbox</span>
            </div>

            <div class="sidebar-section">
                <div class="section-header">
                    <h3 class="section-title">Files</h3>
                    <div class="file-actions">
                        <button class="icon-btn" onclick="createNewFile()" title="New File">üìÑ</button>
                        <button class="icon-btn" onclick="createNewFolder()" title="New Folder">üìÅ</button>
                        <button class="icon-btn" onclick="refreshFiles()" title="Refresh">üîÑ</button>
                    </div>
                </div>
                <div id="file-tree" class="file-tree">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="section-title">Search</h3>
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search in files..." onkeyup="handleSearch(event)">
                </div>
                <div id="search-results" class="search-results"></div>
            </div>

            <div class="sidebar-footer">
                <a href="/" class="btn btn-secondary btn-small">
                    ‚Üê Back to Chat
                </a>
            </div>
        </aside>

        <!-- Editor Area -->
        <main class="editor-main">
            <div class="editor-header">
                <div class="editor-tabs" id="editor-tabs">
                    <div class="editor-tab active" data-path="welcome">
                        <span class="tab-name">Welcome</span>
                    </div>
                </div>
                <div class="editor-actions">
                    <button class="btn btn-small" onclick="saveCurrentFile()" id="save-btn" disabled>
                        üíæ Save
                    </button>
                    <button class="btn btn-small btn-primary" onclick="runCurrentFile()" id="run-btn" disabled>
                        ‚ñ∂Ô∏è Run
                    </button>
                </div>
            </div>

            <div class="editor-container">
                <div class="editor-pane" id="editor-pane">
                    <!-- Welcome content -->
                    <div class="welcome-editor" id="welcome-editor">
                        <div class="welcome-icon">üíª</div>
                        <h2>Coding Sandbox</h2>
                        <p>A safe environment for coding experiments.</p>
                        <div class="welcome-tips">
                            <div class="tip">
                                <span class="tip-icon">üìÑ</span>
                                <span>Create files using the sidebar buttons</span>
                            </div>
                            <div class="tip">
                                <span class="tip-icon">‚úèÔ∏è</span>
                                <span>Edit code with syntax highlighting</span>
                            </div>
                            <div class="tip">
                                <span class="tip-icon">‚ñ∂Ô∏è</span>
                                <span>Run Python files with one click</span>
                            </div>
                            <div class="tip">
                                <span class="tip-icon">üîç</span>
                                <span>Search across all your files</span>
                            </div>
                        </div>
                        <p class="sandbox-path">
                            Sandbox location: <code>~/ChatOS-Sandbox/</code>
                        </p>
                    </div>
                    
                    <!-- Code editor textarea (hidden by default) -->
                    <textarea id="code-editor" class="code-editor" style="display: none;" spellcheck="false"></textarea>
                </div>

                <!-- Output Panel -->
                <div class="output-panel" id="output-panel">
                    <div class="output-header">
                        <span>Output</span>
                        <button class="icon-btn" onclick="clearOutput()">üóëÔ∏è</button>
                    </div>
                    <div class="output-content" id="output-content">
                        <span class="output-placeholder">Run a file to see output here...</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- AI Assistant Panel -->
        <aside class="assistant-panel">
            <div class="sidebar-header">
                <h3>ü§ñ AI Assistant</h3>
            </div>

            <div class="assistant-chat" id="assistant-chat">
                <div class="assistant-message">
                    <p>I can help you with coding tasks! Try commands like:</p>
                    <ul>
                        <li><code>/swarm Build a Flask API</code></li>
                        <li><code>/code Write a sorting function</code></li>
                    </ul>
                </div>
            </div>

            <div class="assistant-input">
                <textarea id="assistant-input" placeholder="Ask for help with your code..." rows="2"></textarea>
                <button class="btn btn-primary btn-small" onclick="askAssistant()">Ask</button>
            </div>
        </aside>
    </div>

    <script>
        // =============================================================================
        // State
        // =============================================================================
        
        let currentFile = null;
        let openFiles = new Map();  // path -> content
        let unsavedChanges = new Set();

        // =============================================================================
        // Initialization
        // =============================================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            loadFileTree();
            setupEditor();
        });

        // =============================================================================
        // File Operations
        // =============================================================================
        
        async function loadFileTree() {
            try {
                const response = await fetch('/api/sandbox/files');
                const data = await response.json();
                renderFileTree(data.root);
            } catch (error) {
                console.error('Failed to load files:', error);
            }
        }

        function renderFileTree(node, level = 0) {
            const container = document.getElementById('file-tree');
            if (level === 0) {
                container.innerHTML = '';
            }

            if (!node.children || node.children.length === 0) {
                if (level === 0) {
                    container.innerHTML = '<div class="empty-tree">No files yet. Create one!</div>';
                }
                return;
            }

            node.children.forEach(child => {
                const item = document.createElement('div');
                item.className = `file-item ${child.is_directory ? 'directory' : 'file'}`;
                item.style.paddingLeft = `${level * 16 + 8}px`;
                
                const icon = child.is_directory ? 'üìÅ' : getFileIcon(child.extension);
                
                item.innerHTML = `
                    <span class="file-icon">${icon}</span>
                    <span class="file-name">${child.name}</span>
                    <div class="file-item-actions">
                        ${!child.is_directory ? `<button class="icon-btn small" onclick="deleteFile('${child.path}', event)">üóëÔ∏è</button>` : ''}
                    </div>
                `;
                
                if (!child.is_directory) {
                    item.onclick = () => openFile(child.path);
                }
                
                container.appendChild(item);
                
                if (child.is_directory && child.children) {
                    renderFileTree(child, level + 1);
                }
            });
        }

        function getFileIcon(ext) {
            const icons = {
                '.py': 'üêç',
                '.js': 'üìú',
                '.ts': 'üìò',
                '.html': 'üåê',
                '.css': 'üé®',
                '.json': 'üìã',
                '.md': 'üìù',
                '.txt': 'üìÑ',
                '.sh': '‚öôÔ∏è',
            };
            return icons[ext] || 'üìÑ';
        }

        async function openFile(path) {
            try {
                const response = await fetch(`/api/sandbox/file?path=${encodeURIComponent(path)}`);
                const data = await response.json();
                
                currentFile = path;
                openFiles.set(path, data.content);
                
                showEditor(path, data.content);
                updateTabs(path);
                updateButtons(true);
            } catch (error) {
                alert('Failed to open file: ' + error.message);
            }
        }

        async function saveCurrentFile() {
            if (!currentFile) return;
            
            const editor = document.getElementById('code-editor');
            const content = editor.value;
            
            try {
                await fetch('/api/sandbox/file', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ path: currentFile, content }),
                });
                
                openFiles.set(currentFile, content);
                unsavedChanges.delete(currentFile);
                updateTabStatus(currentFile, false);
                
                showOutput('‚úÖ File saved: ' + currentFile, 'success');
            } catch (error) {
                showOutput('‚ùå Failed to save: ' + error.message, 'error');
            }
        }

        async function deleteFile(path, event) {
            event.stopPropagation();
            if (!confirm(`Delete ${path}?`)) return;
            
            try {
                await fetch(`/api/sandbox/file?path=${encodeURIComponent(path)}`, {
                    method: 'DELETE',
                });
                
                openFiles.delete(path);
                if (currentFile === path) {
                    currentFile = null;
                    showWelcome();
                    updateButtons(false);
                }
                
                loadFileTree();
                showOutput('üóëÔ∏è Deleted: ' + path, 'info');
            } catch (error) {
                showOutput('‚ùå Failed to delete: ' + error.message, 'error');
            }
        }

        async function createNewFile() {
            const name = prompt('Enter file name (e.g., script.py):');
            if (!name) return;
            
            try {
                await fetch('/api/sandbox/file', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ path: name, content: '' }),
                });
                
                loadFileTree();
                openFile(name);
                showOutput('üìÑ Created: ' + name, 'success');
            } catch (error) {
                showOutput('‚ùå Failed to create: ' + error.message, 'error');
            }
        }

        async function createNewFolder() {
            const name = prompt('Enter folder name:');
            if (!name) return;
            
            try {
                await fetch(`/api/sandbox/directory?path=${encodeURIComponent(name)}`, {
                    method: 'POST',
                });
                
                loadFileTree();
                showOutput('üìÅ Created folder: ' + name, 'success');
            } catch (error) {
                showOutput('‚ùå Failed to create folder: ' + error.message, 'error');
            }
        }

        function refreshFiles() {
            loadFileTree();
            showOutput('üîÑ Files refreshed', 'info');
        }

        // =============================================================================
        // Code Execution
        // =============================================================================
        
        async function runCurrentFile() {
            if (!currentFile || !currentFile.endsWith('.py')) {
                showOutput('‚ö†Ô∏è Only Python files can be run', 'warning');
                return;
            }
            
            // Save first
            await saveCurrentFile();
            
            showOutput('‚ñ∂Ô∏è Running ' + currentFile + '...', 'info');
            
            try {
                const response = await fetch('/api/sandbox/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ file_path: currentFile }),
                });
                
                const result = await response.json();
                
                let output = '';
                if (result.stdout) output += result.stdout;
                if (result.stderr) output += '\n' + result.stderr;
                
                const status = result.success ? 'success' : 'error';
                output += `\n\n‚è±Ô∏è Execution time: ${result.execution_time.toFixed(3)}s`;
                output += `\nüìä Exit code: ${result.exit_code}`;
                
                showOutput(output, status);
            } catch (error) {
                showOutput('‚ùå Execution failed: ' + error.message, 'error');
            }
        }

        // =============================================================================
        // Search
        // =============================================================================
        
        async function handleSearch(event) {
            if (event.key !== 'Enter') return;
            
            const pattern = document.getElementById('search-input').value.trim();
            if (!pattern) return;
            
            try {
                const response = await fetch('/api/sandbox/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pattern }),
                });
                
                const data = await response.json();
                renderSearchResults(data.matches);
            } catch (error) {
                console.error('Search failed:', error);
            }
        }

        function renderSearchResults(matches) {
            const container = document.getElementById('search-results');
            
            if (matches.length === 0) {
                container.innerHTML = '<div class="no-results">No matches found</div>';
                return;
            }
            
            container.innerHTML = matches.map(m => `
                <div class="search-result" onclick="openFileAtLine('${m.file}', ${m.line})">
                    <div class="result-file">${m.file}:${m.line}</div>
                    <div class="result-content">${escapeHtml(m.content)}</div>
                </div>
            `).join('');
        }

        async function openFileAtLine(path, line) {
            await openFile(path);
            // TODO: scroll to line
        }

        // =============================================================================
        // AI Assistant
        // =============================================================================
        
        async function askAssistant() {
            const input = document.getElementById('assistant-input');
            const message = input.value.trim();
            if (!message) return;
            
            input.value = '';
            appendAssistantUserMessage(message);
            appendAssistantResponse('‚è≥ Thinking...');
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message, 
                        mode: 'code',
                        model_id: 'dummy-atlas'  // Use fast dummy model for sandbox assistant
                    }),
                });
                
                const data = await response.json();
                // Replace the "Thinking..." message with actual response
                const chat = document.getElementById('assistant-chat');
                const lastMsg = chat.lastElementChild;
                if (lastMsg && lastMsg.textContent === '‚è≥ Thinking...') {
                    lastMsg.innerHTML = formatCode(data.answer);
                } else {
                    appendAssistantResponse(data.answer);
                }
            } catch (error) {
                const chat = document.getElementById('assistant-chat');
                const lastMsg = chat.lastElementChild;
                if (lastMsg && lastMsg.textContent === '‚è≥ Thinking...') {
                    lastMsg.innerHTML = 'Error: ' + error.message;
                } else {
                    appendAssistantResponse('Error: ' + error.message);
                }
            }
        }

        function appendAssistantUserMessage(text) {
            const chat = document.getElementById('assistant-chat');
            const msg = document.createElement('div');
            msg.className = 'assistant-user-msg';
            msg.textContent = text;
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
        }

        function appendAssistantResponse(text) {
            const chat = document.getElementById('assistant-chat');
            const msg = document.createElement('div');
            msg.className = 'assistant-message';
            msg.innerHTML = formatCode(text);
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
        }

        function formatCode(text) {
            // Basic markdown code formatting
            return text
                .replace(/```(\w*)\n?([\s\S]*?)```/g, '<pre class="code-block"><code>$2</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }

        // =============================================================================
        // Editor UI
        // =============================================================================
        
        function setupEditor() {
            const editor = document.getElementById('code-editor');
            
            editor.addEventListener('input', () => {
                if (currentFile) {
                    unsavedChanges.add(currentFile);
                    updateTabStatus(currentFile, true);
                }
            });
            
            // Tab key handling
            editor.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = editor.selectionStart;
                    const end = editor.selectionEnd;
                    editor.value = editor.value.substring(0, start) + '    ' + editor.value.substring(end);
                    editor.selectionStart = editor.selectionEnd = start + 4;
                }
                
                // Ctrl+S to save
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveCurrentFile();
                }
            });
        }

        function showEditor(path, content) {
            document.getElementById('welcome-editor').style.display = 'none';
            const editor = document.getElementById('code-editor');
            editor.style.display = 'block';
            editor.value = content;
        }

        function showWelcome() {
            document.getElementById('welcome-editor').style.display = 'flex';
            document.getElementById('code-editor').style.display = 'none';
        }

        function updateTabs(activePath) {
            const container = document.getElementById('editor-tabs');
            
            // Check if tab already exists
            let existingTab = container.querySelector(`[data-path="${activePath}"]`);
            
            if (!existingTab) {
                const tab = document.createElement('div');
                tab.className = 'editor-tab';
                tab.dataset.path = activePath;
                tab.innerHTML = `
                    <span class="tab-name">${activePath.split('/').pop()}</span>
                    <button class="tab-close" onclick="closeTab('${activePath}', event)">√ó</button>
                `;
                tab.onclick = () => openFile(activePath);
                container.appendChild(tab);
            }
            
            // Update active state
            container.querySelectorAll('.editor-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.path === activePath);
            });
        }

        function updateTabStatus(path, unsaved) {
            const tab = document.querySelector(`[data-path="${path}"] .tab-name`);
            if (tab) {
                const name = path.split('/').pop();
                tab.textContent = unsaved ? name + ' ‚Ä¢' : name;
            }
        }

        function closeTab(path, event) {
            event.stopPropagation();
            
            if (unsavedChanges.has(path)) {
                if (!confirm('Discard unsaved changes?')) return;
            }
            
            openFiles.delete(path);
            unsavedChanges.delete(path);
            
            const tab = document.querySelector(`[data-path="${path}"]`);
            if (tab) tab.remove();
            
            if (currentFile === path) {
                currentFile = null;
                showWelcome();
                updateButtons(false);
            }
        }

        function updateButtons(enabled) {
            document.getElementById('save-btn').disabled = !enabled;
            document.getElementById('run-btn').disabled = !enabled || !currentFile?.endsWith('.py');
        }

        // =============================================================================
        // Output Panel
        // =============================================================================
        
        function showOutput(text, type = 'info') {
            const container = document.getElementById('output-content');
            const colors = {
                'success': '#00ff88',
                'error': '#ff4444',
                'warning': '#ffaa00',
                'info': '#00d4ff',
            };
            
            container.innerHTML = `<pre style="color: ${colors[type] || '#fff'}">${escapeHtml(text)}</pre>`;
        }

        function clearOutput() {
            document.getElementById('output-content').innerHTML = '<span class="output-placeholder">Run a file to see output here...</span>';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>

    <style>
        /* Sandbox-specific styles */
        .sandbox-app {
            display: grid;
            grid-template-columns: minmax(200px, 250px) 1fr minmax(250px, 300px);
            height: 100vh;
            overflow: hidden;
        }

        .file-explorer {
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .file-explorer .sidebar-header {
            flex-shrink: 0;
        }

        .file-explorer .sidebar-section {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .file-explorer .sidebar-section:first-of-type {
            flex: 2;
        }

        .file-explorer .sidebar-section:last-of-type {
            flex: 1;
        }

        .file-explorer .sidebar-footer {
            flex-shrink: 0;
            margin-top: auto;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .file-actions {
            display: flex;
            gap: 4px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            font-size: 14px;
        }

        .icon-btn:hover {
            background: var(--bg-elevated);
        }

        .icon-btn.small {
            font-size: 12px;
            padding: 2px;
        }

        .file-tree {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
        }

        .file-item:hover {
            background: var(--bg-elevated);
        }

        .file-item:hover .file-item-actions {
            display: flex;
        }

        .file-item-actions {
            display: none;
            margin-left: auto;
        }

        .empty-tree {
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
            font-size: 13px;
        }

        .search-box {
            flex-shrink: 0;
        }

        .search-box input {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 13px;
            box-sizing: border-box;
        }

        .search-results {
            margin-top: 8px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .search-result {
            padding: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            margin-bottom: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .search-result:hover {
            background: var(--bg-elevated);
        }

        .result-file {
            color: var(--accent-primary);
            margin-bottom: 2px;
        }

        .result-content {
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .editor-main {
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .editor-tabs {
            display: flex;
            gap: 4px;
            overflow-x: auto;
        }

        .editor-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }

        .editor-tab.active {
            background: var(--bg-elevated);
            color: var(--accent-primary);
        }

        .tab-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }

        .tab-close:hover {
            color: var(--error);
        }

        .editor-actions {
            display: flex;
            gap: 8px;
        }

        .editor-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .editor-pane {
            flex: 1;
            overflow: hidden;
            display: flex;
        }

        .welcome-editor {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 40px;
            text-align: center;
        }

        .sandbox-path {
            margin-top: 20px;
            color: var(--text-muted);
            font-size: 13px;
        }

        .sandbox-path code {
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .code-editor {
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: none;
            padding: 16px;
            font-family: var(--font-mono);
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
        }

        .output-panel {
            height: 200px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--text-secondary);
        }

        .output-content {
            flex: 1;
            padding: 12px 16px;
            overflow-y: auto;
            font-family: var(--font-mono);
            font-size: 13px;
        }

        .output-placeholder {
            color: var(--text-muted);
        }

        .assistant-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .assistant-chat {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .assistant-message {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 13px;
        }

        .assistant-message ul {
            margin: 8px 0 0 16px;
        }

        .assistant-message code {
            background: var(--bg-elevated);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .assistant-user-msg {
            background: var(--user-bg);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 13px;
        }

        .assistant-input {
            padding: 12px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .assistant-input textarea {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            color: var(--text-primary);
            font-family: var(--font-main);
            font-size: 13px;
            resize: none;
        }

        .sidebar-btn {
            width: 100%;
            margin-bottom: 8px;
        }

        @media (max-width: 1200px) {
            .sandbox-app {
                grid-template-columns: 200px 1fr;
            }
            .assistant-panel {
                display: none;
            }
        }

        @media (max-width: 900px) {
            .sandbox-app {
                grid-template-columns: 180px 1fr;
            }
            .file-explorer .sidebar-section {
                padding: 8px;
            }
            .section-title {
                font-size: 11px;
            }
            .file-item {
                font-size: 12px;
                padding: 4px 6px;
            }
        }

        @media (max-width: 768px) {
            .sandbox-app {
                grid-template-columns: 1fr;
            }
            .file-explorer {
                position: fixed;
                left: 0;
                top: 0;
                width: 250px;
                height: 100vh;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 100;
                background: var(--bg-secondary);
            }
            .file-explorer.open {
                transform: translateX(0);
            }
        }
    </style>
</body>
</html>

